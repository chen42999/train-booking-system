<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" type="image/png" sizes="16x16" href="../static/plugins/images/favicon.png"
          th:href="@{../static/plugins/images/favicon.png}">

    <link href="../static/bootstrap/dist/css/bootstrap.min.css" type="text/css" rel="stylesheet"
          th:href="@{../static/bootstrap/dist/css/bootstrap.min.css}">
    <!-- Menu CSS -->
    <link href="../static/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.css" rel="stylesheet"
          type="text/css" th:href="@{../static/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.css}">
    <!-- toast CSS -->
    <link href="../static/plugins/bower_components/toast-master/css/jquery.toast.css" rel="stylesheet" type="text/css"
          th:href="@{../static/plugins/bower_components/toast-master/css/jquery.toast.css}">
    <!-- animation CSS -->
    <link href="../static/css/animate.css" rel="stylesheet" th:href="@{../static/css/animate.css}">
    <!-- Custom CSS -->
    <link href="../static/css/style.css" rel="stylesheet" th:href="@{../static/css/style.css}">
    <!-- color CSS -->
    <link href="../static/css/colors/blue-dark.css" id="theme" rel="stylesheet"
          th:href="@{../static/css/colors/blue-dark.css}">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<!-- Preloader -->
<div class="preloader">
    <div class="cssload-speeding-wheel"></div>
</div>
<div id="wrapper">
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top m-b-0">
        <div class="navbar-header"><a class="navbar-toggle hidden-sm hidden-md hidden-lg " href="javascript:void(0)"
                                      data-toggle="collapse" data-target=".navbar-collapse"><i class="fa fa-bars
"></i></a>
            <div class="top-left-part"><a class="logo" href="index.html"><b><img
                    src="../static/plugins/images/pixeladmin-logo.png"
                    th:href="@{../static/plugins/images/pixeladmin-logo.png}" alt="home"/></b><span
                    class="hidden-xs"><img src="../static/plugins/images/pixeladmin-text.png"
                                           th:href="@{../static/plugins/images/pixeladmin-text.png}" alt="home"/></span></a>
            </div>
            <ul class="nav navbar-top-links navbar-left m-l-20 hidden-xs">
                <li>
                    <form role="search" class="app-search hidden-xs">
                        <input type="text" placeholder="Search..." class="form-control"> <a href=""><i
                            class="fa fa-search"></i></a>
                    </form>
                </li>
            </ul>
            <ul class="nav navbar-top-links navbar-right pull-right">
                <li>
                    <a class="profile-pic" href="#"> <img src="../static/plugins/images/users/varun.jpg"
                                                          th:href="@{../static/plugins/images/users/varun.jpg}"
                                                          alt="user-img" width="36" class="img-circle"><b
                            class="hidden-xs">Steave</b> </a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-header -->
        <!-- /.navbar-top-links -->
        <!-- /.navbar-static-side -->
    </nav>
    <!-- Left navbar-header -->
    <div class="navbar-default sidebar" role="navigation">
        <div class="sidebar-nav navbar-collapse slimscrollsidebar">
            <ul class="nav" id="side-menu">
                <li style="padding: 10px 0 0;">
                    <a th:href="@{/adminIndex}" class="waves-effect"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i><span class="hide-menu">首页</span></a>
                </li>
                <li>
                    <a th:href="@{/admins/toStation}" class="waves-effect"><i class="fa fa-user fa-fw" aria-hidden="true"></i><span class="hide-menu">站点</span></a>
                </li>
                <li>
                    <a th:href="@{/admins/selectAllStation}" class="waves-effect"><i class="fa fa-table fa-fw" aria-hidden="true"></i><span class="hide-menu">查询站点</span></a>
                </li>
                <li>
                    <a th:href="@{/admins/toUser}" class="waves-effect"><i class="fa fa-table fa-fw" aria-hidden="true"></i><span class="hide-menu">用户管理</span></a>
                </li>
                <li>
                    <a th:href="@{/admins/toRoadMap}" class="waves-effect"><i class="fa fa-table fa-fw" aria-hidden="true"></i><span class="hide-menu">路线图</span></a>
                </li>
                <li>
                    <a th:href="@{/admins/toTrain}" class="waves-effect"><i class="fa fa-table fa-fw" aria-hidden="true"></i><span class="hide-menu">班次表</span></a>
                </li>
                <li>
                    <a href="fontawesome.html" class="waves-effect"><i class="fa fa-font fa-fw" aria-hidden="true"></i><span class="hide-menu">Icons</span></a>
                </li>

                <!-- <li>
                    <a href="map-google.html" class="waves-effect"><i class="fa fa-globe fa-fw" aria-hidden="true"></i><span class="hide-menu">Google Map</span></a>
                </li> -->
                <!-- <li>
                    <a href="blank.html" class="waves-effect"><i class="fa fa-columns fa-fw" aria-hidden="true"></i><span class="hide-menu">Blank Page</span></a>
                </li> -->
                <li>
                    <a href="404.html" class="waves-effect"><i class="fa fa-info-circle fa-fw" aria-hidden="true"></i><span class="hide-menu">Error 404</span></a>
                </li>
            </ul>
            <div class="center p-20">
                <span class="hide-menu"><a href="#" target="_blank"
                                           class="btn btn-danger btn-block btn-rounded waves-effect waves-light">Upgrade to Pro</a></span>
            </div>
        </div>
    </div>
    <!-- Left navbar-header end -->
    <!-- Page Content -->
    <div id="page-wrapper">
        <div class="container-fluid">
            <div class="row bg-title">
                <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
                    <h4 class="page-title">Basic Table</h4></div>
                <div class="col-lg-9 col-sm-8 col-md-8 col-xs-12"><a href="#"
                                                                     class="btn btn-danger pull-right m-l-20 btn-rounded btn-outline hidden-xs hidden-sm waves-effect waves-light">Upgrade
                    to Pro</a>
                    <ol class="breadcrumb">
                        <li><a href="#">Dashboard</a></li>
                        <li class="active">Basic Table</li>
                    </ol>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /row -->
            <div class="row">
                <div class="col-sm-12">
                    <div class="white-box">
                        <h3 class="box-title">Basic Table</h3>
                        <p class="text-muted">Add class <code>.table</code></p>
                        <div class="table-responsive">
                            <table class="table table-hover" id="table">
                                <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>站点名</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="station: ${pageInfo.list}">
                                    <td th:text="${station.id}"></td>
                                    <td th:text="${station.name}"></td>
                                    <td>
                                        <!-- 模态框按钮---修改 -->
                                        <button type="button" class="btn btn-primary btn-sm" data-toggle="modal"
                                                data-target="#updateStationModal" th:data-station="${station.id}">
                                            修改
                                        </button>
<!--                                        <a th:href="@{/admin/updateStation}">删除</a>-->
                                        <!-- 模态框按钮---删除 -->
                                        <button type="button" class="btn btn-primary btn-sm" data-toggle="modal"
                                                data-target="#deleteStationModal" th:data-deleteStationId="${station.id}" th:onclick="getDeleteStationId([[${station.id}]])">
                                            删除
                                        </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <p>当前 <span th:text="${pageInfo.pageNum}"></span> 页,总 <span th:text="${pageInfo.pages}"></span> 页,共 <span th:text="${pageInfo.total}"></span> 条记录</p>
            <a th:href="@{/admins/selectAllStation}">首页</a>
            <a th:href="@{/admins/selectAllStation(pageNum=${pageInfo.hasPreviousPage}?${pageInfo.prePage}:1)}">上一页</a>
            <a th:href="@{/admins/selectAllStation(pageNum=${pageInfo.hasNextPage}?${pageInfo.nextPage}:${pageInfo.pages})}">下一页</a>
            <a th:href="@{/admins/selectAllStation(pageNum=${pageInfo.pages})}">尾页</a>


            <!-- 站点模态框----修改 -->
            <div class="modal fade" id="updateStationModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <form th:action="@{/admins/updateStation}" method="post">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                        aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModalLabel">修改站点</h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label for="stationId" class="control-label">id:</label>
                                    <input type="text" class="form-control" id="stationId" name="stationId" th:name="stationId" disabled/>
                                </div>
                                <div class="form-group">
                                    <label for="stationName" class="control-label">站点名:</label>
                                    <input class="form-control" id="stationName" name="stationName"/>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                <button type="button" class="btn btn-primary" id="saveBtn">保存</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 站点模态框----删除 -->
            <div class="modal fade" tabindex="-1" role="dialog" id="deleteStationModal">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">提示</h4>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="deleteStaId">
                            <p>是否要删除！</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <button type="button" class="btn btn-primary" id="deleteBtn">确定</button>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->

            <!-- /.row -->
        </div>
        <!-- /.container-fluid -->
        <footer class="footer text-center"> 2017 &copy; Pixel Admin brought to you by wrappixel - More Templates <a
                href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a
                href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></footer>
    </div>
    <!-- /#page-wrapper -->
</div>
<!-- /#wrapper -->
<!-- jQuery -->
<script src="../static/plugins/bower_components/jquery/dist/jquery.min.js"
        th:href="@{../static/plugins/bower_components/jquery/dist/jquery.min.js}"></script>
<!-- Bootstrap Core JavaScript -->
<script src="../static/bootstrap/dist/js/bootstrap.min.js"
        th:href="@{../static/bootstrap/dist/js/bootstrap.min.js}"></script>
<!-- Menu Plugin JavaScript -->
<script src="../static/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.js"
        th:href="@{../static/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.js}"></script>
<!--slimscroll JavaScript -->
<script src="../static/js/jquery.slimscroll.js" th:href="@{../static/js/jquery.slimscroll.js}"></script>
<!--Wave Effects -->
<script src="../static/js/waves.js" th:href="@{../static/js/waves.js}"></script>
<!-- Custom Theme JavaScript -->
<script src="../static/js/custom.min.js" th:href="@{../static/js/custom.min.js}"></script>
</body>

<script>
    // 用于向模态框里传值
    $('#updateStationModal').on('show.bs.modal', function (event) {
        let btn = $(event.relatedTarget)
        let stationId = btn.data('station')
        console.log(stationId)
        let modal = $(this)

        $.ajax({
            url: '/admins/selectSingleStation',
            data: {stationId: stationId},
            dataType: 'json',
            type: 'get',
            contentType: 'application/json',
            success: function (data) {
                modal.find(".modal-body #stationId").val(data.id)
                modal.find(".modal-body #stationName").val(data.name)
                console.log(data.id)
                console.log(data.name)
            },
            error: function (data) {
                console.log(data)
            }
        })
    })

    // 当点击保存按钮是，往后台发送修改后的站点信息
    $('#saveBtn').click(function () {
        let sId = $('#stationId').val()
        let sName = $('#stationName').val()

        $.ajax({
            url: '/admins/updateStation',
            data: {stationId: sId, stationName: sName},
            success: function (data) {
                if (data === true){
                    selectAllStation()
                    $('#updateStationModal').modal('hide')
                }
            },
            error: function (data) {
                alert("错误")
            }
        })
    })

    // 在更新完站点操作后，查询全部站点并刷新
    function selectAllStation() {
        $.ajax({
            url: '/admins/selectAllStation',
            success: function (msg) {
                // 刷新页面
                window.location.reload()
            },
            error: function (data) {
                alert("错误")
            }
        })
    }

    // 获得要删除站点的id，模态框获得隐藏的id值
    function getDeleteStationId(id) {
        $('#deleteStaId').val(id)
    }

    // 实现删除站点功能并把整个页面刷新
    $('#deleteBtn').click(function () {
        let id = $('#deleteStaId').val()
        $.ajax({
            url: '/admins/deleteSingleStation',
            data: {stationId: id},
            dataType: 'json',
            success: function (data) {
                if (data === true){
                    selectAllStation()
                    $('#deleteStationModal').modal('hide')
                }
            }
        })
    })


</script>

</html>
